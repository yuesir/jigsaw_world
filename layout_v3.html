<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹¼å›¾ç¢ç‰‡èºæ—‹å¸ƒå±€ - åŸå§‹ç®—æ³•</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Space+Mono:wght@400;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-dark: #1a1d29;
            --bg-light: #242938;
            --accent-blue: #4a9eff;
            --accent-purple: #b084ff;
            --accent-green: #4ade80;
            --text-primary: #e8eaed;
            --text-secondary: #9ca3af;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark), #0f1219);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        .container { max-width: 1600px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 2rem; }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
        }
        
        .controls {
            background: var(--bg-light);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        label {
            font-weight: 500;
            color: var(--accent-blue);
            min-width: 100px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            background: #374151;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%;
            cursor: pointer;
        }
        
        .value {
            font-family: 'Space Mono', monospace;
            color: var(--accent-green);
            font-weight: 700;
            min-width: 60px;
        }
        
        .buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s;
        }
        
        button:hover { transform: translateY(-2px); }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-family: 'Space Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-green);
        }
        
        .canvas-container {
            background: var(--bg-light);
            border-radius: 12px;
            overflow: hidden;
        }
        
        canvas { display: block; width: 100%; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>æ‹¼å›¾ç¢ç‰‡èºæ—‹å¸ƒå±€</h1>
            <p class="subtitle">JigsawExplorer åŸå§‹ç®—æ³•å®ç°</p>
        </header>
        
        <div class="controls">
            <div class="control-group">
                <label>ç¢ç‰‡æ•°é‡</label>
                <input type="range" id="count" min="20" max="1000" value="80" step="10">
                <span class="value" id="countVal">80</span>
            </div>
            <div class="buttons">
                <button onclick="set(35)">35ç‰‡</button>
                <button onclick="set(80)">80ç‰‡</button>
                <button onclick="set(150)">150ç‰‡</button>
                <button onclick="set(300)">300ç‰‡</button>
                <button onclick="set(500)">500ç‰‡</button>
                <button onclick="set(1000)">1000ç‰‡</button>
                <button onclick="generate()">é‡æ–°ç”Ÿæˆ</button>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-label">æ€»ç¢ç‰‡</div>
                <div class="stat-value" id="total">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">å·²æ”¾ç½®</div>
                <div class="stat-value" id="placed">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Gï¼ˆæ¨ªå‘å‰©ä½™ï¼‰</div>
                <div class="stat-value" id="g" style="font-size:1rem">0px</div>
            </div>
            <div class="stat">
                <div class="stat-label">Vï¼ˆçºµå‘å‰©ä½™ï¼‰</div>
                <div class="stat-value" id="v" style="font-size:1rem">0px</div>
            </div>
            <div class="stat">
                <div class="stat-label">Nï¼ˆçºµå‘å±‚æ•°ï¼‰</div>
                <div class="stat-value" id="n">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Rï¼ˆæ¨ªå‘å±‚æ•°ï¼‰</div>
                <div class="stat-value" id="r">0</div>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="canvas" width="1600" height="900"></canvas>
        </div>
        
        <div class="controls" style="margin-top: 1.5rem;">
            <h3 style="color: var(--accent-purple); margin-bottom: 1rem; font-size: 1rem;">ğŸ§© è‡ªé€‚åº”å®½é«˜æ¯”ç®—æ³•è¯´æ˜</h3>
            <div style="color: var(--text-secondary); line-height: 1.6; font-size: 0.9rem;">
                <p style="margin-bottom: 0.75rem;">
                    <strong style="color: var(--accent-blue);">æ ¸å¿ƒé€»è¾‘ï¼š</strong>
                    ç®—æ³•æ ¹æ®<strong>æ¨ªå‘å‰©ä½™ç©ºé—´(G)</strong>å’Œ<strong>çºµå‘å‰©ä½™ç©ºé—´(V)</strong>çš„å¤§å°å…³ç³»ï¼Œè‡ªåŠ¨è°ƒæ•´ç¢ç‰‡åˆ†å¸ƒã€‚
                    æ”¯æŒ20-1000ç‰‡ç¢ç‰‡ï¼ˆè¶…è¿‡300ç‰‡ä½¿ç”¨ç®€åŒ–ç»˜åˆ¶ä»¥æå‡æ€§èƒ½ï¼‰ã€‚
                </p>
                <p style="margin-bottom: 0.75rem;">
                    <strong style="color: var(--accent-green);">å½“å‰é…ç½®ï¼ˆæ¨ªå±ï¼‰ï¼š</strong>
                    ç”»å¸ƒ1600Ã—900ï¼Œæ‹¼å›¾1000Ã—600 â†’ G=600px, V=300px â†’ G > V<br>
                    <span style="color: var(--accent-blue);">â†’ é™åˆ¶çºµå‘å±‚æ•°N â‰ˆ 7</span>ï¼Œ
                    <span style="color: var(--accent-green);">â†’ æ¨ªå‘å±‚æ•°Rä¿æŒå……è¶³</span>
                </p>
                <p style="margin-bottom: 0.75rem;">
                    <strong style="color: var(--accent-purple);">ç»“æœï¼š</strong>
                    å‘å³/å·¦ç§»åŠ¨éœ€è¦N>0ï¼Œè½¬7æ¬¡åN=0 â†’ <strong style="color: #4ade80;">ä¸Šä¸‹è¾¹æ¡†è–„(1-3å±‚)</strong><br>
                    å‘ä¸Š/ä¸‹ç§»åŠ¨éœ€è¦R>0ï¼ŒRå……è¶³ â†’ <strong style="color: #f59e0b;">å·¦å³è¾¹æ¡†åš(6-8å±‚)</strong>
                </p>
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 1rem;">
                    ğŸ’¡ æç¤ºï¼šç»¿è‰²âœ“è¡¨ç¤ºç¬¦åˆé¢„æœŸï¼Œæ©™è‰²è¡¨ç¤ºéœ€è¦è°ƒæ•´ç¢ç‰‡æ•°é‡ã€‚æ‰“å¼€æ§åˆ¶å°å¯æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ã€‚<br>
                    âš¡ æ€§èƒ½ï¼šå¤§äº300ç‰‡æ—¶è‡ªåŠ¨ä½¿ç”¨ç®€åŒ–ç»˜åˆ¶æ¨¡å¼ï¼Œ1000ç‰‡å¸ƒå±€è€—æ—¶çº¦1-3ç§’ã€‚
                </p>
            </div>
        </div>
    </div>
    
    <script>
        const CFG = {
            W: 1600, H: 900,
            PW: 1000, PH: 600,
            PieceW: 50, PieceH: 40
        };
        
        class Piece {
            constructor(id, edge) {
                this.id = id;
                this.edge = edge;
                this.x = 0;
                this.y = 0;
            }
            draw(ctx, simple = false) {
                ctx.fillStyle = this.edge ? '#4a9eff' : '#f59e0b';
                ctx.fillRect(this.x, this.y, CFG.PieceW, CFG.PieceH);
                
                if (!simple) {
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(this.x, this.y, CFG.PieceW, CFG.PieceH);
                }
            }
        }
        
        let mgr = {
            pieces: [],
            placed: [],
            
            gen(cnt) {
                this.pieces = [];
                const ratio = CFG.PW / CFG.PH;
                const rows = Math.ceil(Math.sqrt(cnt / ratio));
                const cols = Math.ceil(cnt / rows);
                
                for (let i = 0; i < cnt; i++) {
                    const r = Math.floor(i / cols);
                    const c = i % cols;
                    const edge = r === 0 || r === rows - 1 || c === 0 || c === cols - 1;
                    this.pieces.push(new Piece(i, edge));
                }
            },
            
            scatter() {
                const startTime = performance.now();
                this.placed = [];
                
                // è®¡ç®—å‚æ•°ï¼ˆä¸¥æ ¼æŒ‰åŸå§‹ä»£ç ï¼‰
                const n = { width: CFG.W, height: CFG.H };
                const subj = { width: CFG.PW, height: CFG.PH };
                
                const p = CFG.PieceW * 1.05;
                const g = CFG.PieceH * 1.05;
                const l = p / 4;
                const c = g / 4;
                const u = p / 8;
                const d = g / 8;
                
                const useBorder = this.pieces.length >= 35;
                let w = useBorder ? (n.width - l) / p : n.width / p;
                let P = useBorder ? (n.height - c) / g : n.height / g;
                let S = p * (w / Math.floor(w));
                let C = g * (P / Math.floor(P));
                
                const T = S / 2;
                const z = C / 2;
                
                let I = p / 2 + (useBorder ? u : 0);
                let L = g / 2 + (useBorder ? d : 0);
                let O = n.width - (useBorder ? u : 0);
                let A = C + (useBorder ? d : 0);
                let M = n.height - (useBorder ? d : 0);
                let b = useBorder ? u : 0;
                
                let N = 999;
                let R = 999;
                
                const G = n.width - subj.width;
                const V = n.height - subj.height;
                
                // å…³é”®åˆ¤æ–­
                if (G < V) {
                    R = Math.floor(G / S);
                } else {
                    N = Math.floor(V / C);
                }
                
                const initN = N;
                const initR = R;
                
                let j = 3;  // æ–¹å‘
                const B = [];  // ç¢°æ’æ£€æµ‹
                const m = [...this.pieces];  // é˜Ÿåˆ—
                const W = m.length;
                let U = 0;
                
                const pL = (n.width - subj.width) / 2;
                const pR = pL + subj.width;
                const pT = (n.height - subj.height) / 2;
                const pB = pT + subj.height;
                
                console.log('=== è‡ªé€‚åº”å®½é«˜æ¯”å¸ƒå±€ ===');
                console.log(`ç”»å¸ƒå°ºå¯¸: ${n.width}Ã—${n.height}`);
                console.log(`æ‹¼å›¾å°ºå¯¸: ${subj.width}Ã—${subj.height}`);
                console.log(`ç¢ç‰‡æ€»æ•°: ${W}ç‰‡ ${W > 500 ? 'âš ï¸ å¤§æ•°é‡ï¼Œä½¿ç”¨ç®€åŒ–ç»˜åˆ¶' : ''}`);
                console.log(`æ¨ªå‘å‰©ä½™ç©ºé—´ G = ${G}px`);
                console.log(`çºµå‘å‰©ä½™ç©ºé—´ V = ${V}px`);
                console.log(`G ${G < V ? '<' : '>'} V â†’ ${G < V ? 'ç«–å±æ¨¡å¼ï¼ˆé™åˆ¶Rï¼‰' : 'æ¨ªå±æ¨¡å¼ï¼ˆé™åˆ¶Nï¼‰'}`);
                console.log(`åˆå§‹ N = ${N === 999 ? 'å……è¶³' : N} (çºµå‘å±‚æ•°ï¼Œæ§åˆ¶èƒ½å‘å³/å·¦è½¬å‡ æ¬¡)`);
                console.log(`åˆå§‹ R = ${R === 999 ? 'å……è¶³' : R} (æ¨ªå‘å±‚æ•°ï¼Œæ§åˆ¶èƒ½å‘ä¸Š/ä¸‹è½¬å‡ æ¬¡)`);
                console.log(`é¢„æœŸç»“æœ: ${G < V ? 'ä¸Šä¸‹è¾¹æ¡†åšï¼Œå·¦å³è¾¹æ¡†è–„' : 'ä¸Šä¸‹è¾¹æ¡†è–„ï¼Œå·¦å³è¾¹æ¡†åš'}`);
                console.log('========================');
                
                // ä¸»å¾ªç¯
                const logInterval = W > 500 ? 100 : (W > 200 ? 50 : 20);
                let logCount = 0;
                
                while (m.length > 0) {
                    const t = m.pop();
                    
                    // ç¢°æ’æ£€æµ‹
                    let Y = false;
                    for (const r of B) {
                        if (Math.abs(I - r.x) < CFG.PieceW && Math.abs(L - r.y) < CFG.PieceH) {
                            Y = true;
                            break;
                        }
                    }
                    
                    // ä¸­å¤®åŒºåŸŸæ£€æµ‹
                    const tx = I - CFG.PieceW / 2;
                    const ty = L - CFG.PieceH / 2;
                    if (!(tx + CFG.PieceW <= pL || tx >= pR || ty + CFG.PieceH <= pT || ty >= pB)) {
                        Y = true;
                    }
                    
                    // åˆ¤æ–­èƒ½å¦æ”¾ç½®
                    const X = !Y && ((j === 3 && N > 0) || (j === 2 && N > 0) || 
                                    (j === 0 && R > 0) || (j === 1 && R > 0));
                    
                    if (X) {
                        const rnd = () => (Math.random() >= 0.5 ? 1 : -1) * Math.random();
                        t.x = I + rnd() * p * 0.0625 - CFG.PieceW / 2;
                        t.y = L + rnd() * g * 0.0625 - CFG.PieceH / 2;
                        this.placed.push(t);
                        B.push({ x: I, y: L });
                        U++;
                        
                        if (U % logInterval === 0) {
                            console.log(`è¿›åº¦: ${U}/${W} (${(U/W*100).toFixed(1)}%)`);
                        }
                    } else {
                        m.push(t);
                    }
                    
                    // ç§»åŠ¨
                    const ee = Y ? T : S;
                    const te = Y ? z : C;
                    let f, v;
                    
                    switch (j) {
                        case 3:
                            f = I + ee;
                            if (f > O - l) {
                                j = 1;
                                N--;
                                I = O - p / 2;
                                if (X) L += te;
                                if (R > 0) O -= S;
                                if (N % 2 === 0 || N <= 2) console.log(`è½¬å‘: å³â†’ä¸‹, N=${N}, R=${R}`);
                            } else I = f;
                            break;
                        case 1:
                            v = L + te;
                            if (v > M - c) {
                                j = 2;
                                R--;
                                L = M - g / 2;
                                if (X) I -= ee;
                                if (N > 0) M -= C;
                                if (R % 5 === 0 || R <= 5) console.log(`è½¬å‘: ä¸‹â†’å·¦, N=${N}, R=${R}`);
                            } else L = v;
                            break;
                        case 2:
                            f = I - ee;
                            if (f < b + l) {
                                j = 0;
                                N--;
                                I = b + p / 2;
                                if (X) L -= te;
                                if (R > 0) b += S;
                                if (N % 2 === 0 || N <= 2) console.log(`è½¬å‘: å·¦â†’ä¸Š, N=${N}, R=${R}`);
                            } else I = f;
                            break;
                        case 0:
                            v = L - te;
                            if (v < A + c) {
                                j = 3;
                                R--;
                                L = A + g / 2;
                                if (X) I += ee;
                                if (N > 0) A += C;
                                if (R % 5 === 0 || R <= 5) console.log(`è½¬å‘: ä¸Šâ†’å³, N=${N}, R=${R}`);
                            } else L = v;
                            break;
                    }
                }
                
                console.log(`å¸ƒå±€å®Œæˆ: ${U}/${W}, æœ€ç»ˆ N=${N}, R=${R}`);
                
                // ç»Ÿè®¡è¾¹æ¡†
                const cx = (n.width - subj.width) / 2;
                const cy = (n.height - subj.height) / 2;
                const top = this.placed.filter(p => p.y + CFG.PieceH <= cy).length;
                const bottom = this.placed.filter(p => p.y >= cy + CFG.PH).length;
                const left = this.placed.filter(p => p.x + CFG.PieceW <= cx).length;
                const right = this.placed.filter(p => p.x >= cx + CFG.PW).length;
                
                const topLayers = Math.ceil(top / (CFG.PW / CFG.PieceW));
                const bottomLayers = Math.ceil(bottom / (CFG.PW / CFG.PieceW));
                const leftLayers = Math.ceil(left / (CFG.PH / CFG.PieceH));
                const rightLayers = Math.ceil(right / (CFG.PH / CFG.PieceH));
                
                console.log('=== è¾¹æ¡†ç»Ÿè®¡ ===');
                console.log(`ä¸Šè¾¹æ¡†: ${top}ç‰‡, ${topLayers}å±‚ ${topLayers <= 3 ? 'âœ“(è–„)' : 'âœ—(åš)'}`);
                console.log(`ä¸‹è¾¹æ¡†: ${bottom}ç‰‡, ${bottomLayers}å±‚ ${bottomLayers <= 3 ? 'âœ“(è–„)' : 'âœ—(åš)'}`);
                console.log(`å·¦è¾¹æ¡†: ${left}ç‰‡, ${leftLayers}å±‚ ${leftLayers >= 6 ? 'âœ“(åš)' : 'âœ—(è–„)'}`);
                console.log(`å³è¾¹æ¡†: ${right}ç‰‡, ${rightLayers}å±‚ ${rightLayers >= 6 ? 'âœ“(åš)' : 'âœ—(è–„)'}`);
                console.log('================');
                
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);
                console.log(`â±ï¸ å¸ƒå±€è€—æ—¶: ${duration}ms`);
                
                return { G, V, N: initN, R: initR, placed: U, total: W };
            },
            
            draw() {
                const ctx = document.getElementById('canvas').getContext('2d');
                ctx.fillStyle = '#242938';
                ctx.fillRect(0, 0, CFG.W, CFG.H);
                
                // ä¸­å¤®åŒºåŸŸ
                const cx = (CFG.W - CFG.PW) / 2;
                const cy = (CFG.H - CFG.PH) / 2;
                
                ctx.strokeStyle = 'rgba(74, 158, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 5]);
                ctx.strokeRect(cx, cy, CFG.PW, CFG.PH);
                ctx.setLineDash([]);
                
                ctx.fillStyle = '#4a9eff';
                ctx.font = '14px monospace';
                ctx.textAlign = 'center';
                ctx.fillText('ä¸­å¤®æ‹¼å›¾åŒºåŸŸ', CFG.W / 2, cy - 10);
                ctx.font = '11px monospace';
                ctx.fillStyle = 'rgba(74, 158, 255, 0.5)';
                ctx.fillText(`${CFG.PW}Ã—${CFG.PH}`, CFG.W / 2, cy - 25);
                
                // ç»Ÿè®¡å„è¾¹æ¡†çš„ç¢ç‰‡æ•°
                const top = this.placed.filter(p => p.y + CFG.PieceH <= cy).length;
                const bottom = this.placed.filter(p => p.y >= cy + CFG.PH).length;
                const left = this.placed.filter(p => p.x + CFG.PieceW <= cx).length;
                const right = this.placed.filter(p => p.x >= cx + CFG.PW).length;
                
                // è®¡ç®—å±‚æ•°
                const topLayers = Math.ceil(top / (CFG.PW / CFG.PieceW));
                const bottomLayers = Math.ceil(bottom / (CFG.PW / CFG.PieceW));
                const leftLayers = Math.ceil(left / (CFG.PH / CFG.PieceH));
                const rightLayers = Math.ceil(right / (CFG.PH / CFG.PieceH));
                
                // ç»˜åˆ¶è¾¹æ¡†æ ‡æ³¨
                ctx.font = 'bold 13px monospace';
                ctx.textAlign = 'center';
                
                // ä¸Šè¾¹æ¡†
                ctx.fillStyle = topLayers <= 3 ? '#4ade80' : '#f59e0b';
                ctx.fillText(`â†‘ ä¸Š: ${top}ç‰‡ (${topLayers}å±‚)`, CFG.W / 2, 25);
                
                // ä¸‹è¾¹æ¡†
                ctx.fillStyle = bottomLayers <= 3 ? '#4ade80' : '#f59e0b';
                ctx.fillText(`â†“ ä¸‹: ${bottom}ç‰‡ (${bottomLayers}å±‚)`, CFG.W / 2, CFG.H - 10);
                
                // å·¦è¾¹æ¡†
                ctx.save();
                ctx.translate(25, CFG.H / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = leftLayers >= 6 ? '#4ade80' : '#f59e0b';
                ctx.fillText(`â† å·¦: ${left}ç‰‡ (${leftLayers}å±‚)`, 0, 0);
                ctx.restore();
                
                // å³è¾¹æ¡†
                ctx.save();
                ctx.translate(CFG.W - 25, CFG.H / 2);
                ctx.rotate(Math.PI / 2);
                ctx.fillStyle = rightLayers >= 6 ? '#4ade80' : '#f59e0b';
                ctx.fillText(`â†’ å³: ${right}ç‰‡ (${rightLayers}å±‚)`, 0, 0);
                ctx.restore();
                
                // ç¢ç‰‡
                const useSimple = this.pieces.length > 300;
                for (const p of this.placed) {
                    p.draw(ctx, useSimple);
                }
                
                // å·¦ä¸Šè§’ç»Ÿè®¡æ¡†
                ctx.fillStyle = 'rgba(26, 29, 41, 0.9)';
                ctx.fillRect(10, 50, 200, 110);
                
                ctx.font = '12px monospace';
                ctx.textAlign = 'left';
                
                ctx.fillStyle = '#4a9eff';
                ctx.fillText(`è¾¹ç¼˜: ${this.placed.filter(p => p.edge).length}`, 20, 70);
                ctx.fillStyle = '#f59e0b';
                ctx.fillText(`å†…éƒ¨: ${this.placed.filter(p => !p.edge).length}`, 20, 90);
                ctx.fillStyle = '#4ade80';
                ctx.fillText(`å·²æ”¾ç½®: ${this.placed.length}`, 20, 110);
                ctx.fillStyle = '#e8eaed';
                ctx.fillText(`æ€»è®¡: ${this.pieces.length}`, 20, 130);
                
                const unplaced = this.pieces.length - this.placed.length;
                if (unplaced > 0) {
                    ctx.fillStyle = '#ef4444';
                    ctx.fillText(`æœªæ”¾ç½®: ${unplaced}`, 20, 150);
                }
            }
        };
        
        function generate() {
            const totalStart = performance.now();
            const cnt = parseInt(document.getElementById('count').value);
            
            console.clear();
            console.log(`%cğŸ® å¼€å§‹ç”Ÿæˆ ${cnt} ç‰‡æ‹¼å›¾å¸ƒå±€`, 'color: #4a9eff; font-weight: bold; font-size: 14px;');
            
            mgr.gen(cnt);
            const stats = mgr.scatter();
            
            const drawStart = performance.now();
            mgr.draw();
            const drawTime = (performance.now() - drawStart).toFixed(2);
            
            const totalTime = (performance.now() - totalStart).toFixed(2);
            console.log(`ğŸ¨ ç»˜åˆ¶è€—æ—¶: ${drawTime}ms`);
            console.log(`â° æ€»è€—æ—¶: ${totalTime}ms`);
            
            document.getElementById('total').textContent = stats.total;
            document.getElementById('placed').textContent = stats.placed;
            document.getElementById('g').textContent = stats.G + 'px';
            document.getElementById('v').textContent = stats.V + 'px';
            document.getElementById('n').textContent = stats.N === 999 ? 'å……è¶³' : stats.N;
            document.getElementById('r').textContent = stats.R === 999 ? 'å……è¶³' : stats.R;
        }
        
        function set(n) {
            document.getElementById('count').value = n;
            document.getElementById('countVal').textContent = n;
            generate();
        }
        
        document.getElementById('count').addEventListener('input', e => {
            document.getElementById('countVal').textContent = e.target.value;
        });
        
        document.getElementById('count').addEventListener('change', generate);
        window.addEventListener('load', generate);
    </script>
</body>
</html>
